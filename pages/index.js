import dynamic from 'next/dynamic'
import Head from 'next/head';
import {useState, useEffect} from 'react';

import Navbar from '../components/Navbar';
import Information from '../components/Information';
import Chat from '../components/Chat';
const Map = dynamic(() => import("../components/Map"), {
    loading: () => <p><b>El mapa está cargando...</b></p>,
    ssr: false
   });


import io from 'socket.io-client';


export default function Home() {
  
  // Se crean las variables de estado
  const [flights, setFlights] = useState([]);
  const [mapFlights, setMapFlights] = useState([]);
  
  // Se consume el websocket
  useEffect(() => {
    
    const socket = io("wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl", {
        path: '/flights'
    });
    
    socket.emit('FLIGHTS');
    socket.on('FLIGHTS', data => {
      setFlights(data); 
      setMapFlights(data); 
    });
  }, []);    
    
  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Navbar/>
      <main>
      <div className="grid mx-20 my-10 text-center 	">
        <div className="grid grid-cols-6 gap-4 grid-flow-col		">
          <Map flights={mapFlights}/>         
          <Chat/>
      </div>
      <div className="grid mx-20 my-10 text-center 	">
          <div className="grid col-start-1 col-span-5 justify-self-auto ">
            <h1><b>Información de vuelos en curso</b></h1><br/>
            <Information flights={flights} />
          </div>
        </div>
      </div>
      </main>    
    </div>
  )
}
